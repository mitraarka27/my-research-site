---
import ProjectCard from "../../components/ProjectCard.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const entries = await getCollection("projects");
  const tags = new Set(entries.flatMap(e => e.data.tags || []));
  return Array.from(tags).map((t) => ({ params: { tag: t } }));
}

const { tag } = Astro.params;
const entries = await getCollection("projects");
const list = entries
  .filter(e => (e.data.tags || []).includes(tag!))
  .sort((a,b)=> b.data.date.valueOf()-a.data.date.valueOf());
---
<!DOCTYPE html>
<html lang="en">
  <body class="bg-[#f8f9fa] text-gray-900">
    <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <section class="p-8 bg-white shadow-xl rounded-xl">
        <h1 class="text-3xl font-bold border-b-2 border-blue-200 pb-2 mb-6">Theme: {tag}</h1>
        <div class="grid gap-8">
          {list.map((e) => (
            <ProjectCard entry={e} href={`/research/${e.slug}`} />
          ))}
        </div>
      </section>
      <div class="mt-6">
        <a href="/research" class="underline">‚Üê Back to Research</a>
      </div>
    </main>
  </body>
</html>

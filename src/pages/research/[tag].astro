---
import Base from "@/layouts/Base.astro";
import { getCollection } from "astro:content";
import { tagToSlug, slugToTag } from "@/utils/tags";

const projects = await getCollection("projects");

// Unique slugs
const allTags = Array.from(
  new Set(projects.flatMap(p => (p.data.tags || [])))
);

export async function getStaticPaths() {
  return allTags.map((t) => ({
    params: { tag: tagToSlug(t) },
  }));
}

const { tag } = Astro.params;
const resolvedTag = slugToTag(tag, allTags);

// Filter projects by resolved (original) tag
const items = projects.filter(p => (p.data.tags || []).includes(resolvedTag));
---

<Base title={`Research â€” ${resolvedTag}`}>
  <h1 class="text-3xl font-semibold mb-6">Tag: {resolvedTag}</h1>
  {items.length === 0 ? (
    <p>No projects for this tag.</p>
  ) : (
    <ul class="grid gap-6">
      {items.map(({ slug, data }) => (
        <li>
          <a href={`/research/${slug}/`} class="underline">{data.title}</a>
        </li>
      ))}
    </ul>
  )}
</Base>
